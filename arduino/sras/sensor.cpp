#define PIN_LUM 13
#define FLT_MAX 1e8

#include "Arduino.h"
#include "sensor.hpp"


namespace sensor {

const float HUMI_MAP[][15] = {
  { FLT_MAX, FLT_MAX, 12000, 5200, 2800, 720, 384, 200, 108, 64, 38, 23, 16, 10.2, 6.9 },
  { FLT_MAX, 19800, 9800, 4700, 2000, 510, 271, 149, 82, 48, 29, 18, 12, 8.2, 5.4 },
  { FLT_MAX, 16000, 7200, 3200, 1400, 386, 211, 118, 64, 38, 24, 15, 10.2, 6.9, 4.7 },
  { 21000, 10500, 5100, 2350, 1050, 287, 159, 91, 51, 31, 19, 12, 8.1, 5.5, 4.1 },
  { 13500, 6700, 3300, 1800, 840, 216, 123, 70, 40, 25, 16, 10, 7.2, 4.7, 3.2 },
  { 9800, 4803, 2500, 1300, 630, 166, 95, 55, 31, 21, 13, 8.5, 5.7, 4, 2.8 },
  { 8000, 3900, 2000, 980, 470, 131, 77, 44, 25, 17, 10.5, 7.2, 5, 3.6, 2.5 },
  { 6300, 3100, 1500, 750, 385, 104, 63, 38, 21, 13, 9, 6.4, 4.4, 3.2, 2.3 },
  { 4600, 2300, 1100, 575, 282, 80, 52, 32, 17, 11, 8.2, 5.8, 4, 2.9, 2.1 },
  { 3800, 1850, 900, 430, 210, 66, 45, 20, 14, 9, 7.1, 5, 3.3, 2.4, 1.8 },
  { 3200, 1550, 750, 350, 170, 51, 38, 24, 12, 8, 6, 4.1, 2.9, 2, 1.5 },
};


int humidity(int temperature, float resistance) {
  int values_i = (2 * temperature + 5) / 10;
  // row
  const float *row = HUMI_MAP[values_i];

  float cell = row[0];

  int i;
  for (i = 0; !(cell < resistance) && (i < 15); i++) {
    cell = row[i];
  }

  return i - 1;
}

}
